
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
\1

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Yerel -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif Font TanÄ±mlarÄ± -->
<style>
html,body{
  height:100%;
  margin:0;
  font-family:'-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif', sans-serif !important;
  background:#f7f9fb;
  overflow:hidden;
}

/* Sidebar */
#sidebar{
  position:absolute;
  left:0;top:0;
  width:340px;height:100%;
  background:#fff;
  border-right:1px solid #e6eef6;
  box-shadow:2px 0 6px rgba(0,0,0,0.06);
  padding:18px;
  box-sizing:border-box;
  overflow:auto;
  transition:transform .35s ease;
  z-index:1200;
}
#sidebar.closed{transform:translateX(-100%);}
#toggle-btn{
  position:absolute;
  top:20px;left:340px;
  width:28px;height:48px;
  background:#fff;border:1px solid #d0d7df;border-left:none;
  border-radius:0 6px 6px 0;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;z-index:2000;
  box-shadow:0 1px 3px rgba(0,0,0,0.15);
  transition:background 0.2s ease, left .35s ease;
}
#toggle-btn:hover{background:#f3f4f6;}
#toggle-btn span{font-size:14pt;color:#333;user-select:none;}
#sidebar h1{font-weight:700;font-size:12pt;margin:4px 0 8px;}
#sidebar .description{font-weight:400;font-style:italic;font-size:8pt;color:#445;line-height:1.2;margin-bottom:12px;}
#search{width:100%;padding:6px 8px;font-size:8pt;font-style:italic;border:1px solid #d0d7df;border-radius:6px;margin-bottom:12px;box-sizing:border-box;}
.film{margin-bottom:10px;border-bottom:1px solid #f0f4f8;padding-bottom:8px;}
.film-title{cursor:pointer;font-weight:500;font-size:11pt;color:#333;margin-bottom:6px;}
.mekan-list{list-style:disc;margin:0 0 0 18px;padding:0;display:none;}
.mekan-list li{font-weight:400;font-size:9pt;margin-bottom:6px;cursor:pointer;color:#333;}
.mekan-list li:hover{text-decoration:underline;}
#map{position:absolute;left:0;top:0;right:0;bottom:0;z-index:1;}
.leaflet-control-zoom{position:absolute !important;bottom:50px;right:20px;transform:scale(0.8);border-radius:6px;box-shadow:0 1px 2px rgba(0,0,0,0.1);}
.leaflet-popup-content img{max-width:260px;height:auto;border-radius:6px;margin-top:6px;display:block;}
.leaflet-popup-content-wrapper {width:300px !important;max-width:300px !important;}
.leaflet-popup-content { font-family: '-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif', sans-serif !important; font-weight: 400; }
.leaflet-control-attribution{display:none !important;}</style>
<style>body, html, .leaflet-popup-content { font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif !important; }.leaflet-control-attribution{display:none !important;}</style>
<style>
.leaflet-popup-content-wrapper,
.leaflet-popup-content,
.leaflet-popup-tip,
.leaflet-container,
.leaflet-popup {
  font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif !important;
  -webkit-font-smoothing: antialiased !important;
  -moz-osx-font-smoothing: grayscale !important;
}
.leaflet-control-attribution{display:none !important;}</style>
</head>

<body>
<aside id="sidebar">
  <h1>Ankara SinemasÄ± HaritasÄ±: Filmler ve MekÃ¢nlar ðŸŽ¬</h1>
  <div class="description">
    Bu Ã§alÄ±ÅŸma Ankara Ãœniversitesi Sosyal Bilimler EnstitÃ¼sÃ¼ Radyo Televizyon ve Sinema Anabilim DalÄ±'nda 
    Prof. Dr. S. Ruken Ã–ztÃ¼rk danÄ±ÅŸmanlÄ±ÄŸÄ±nda Sezer Ahmet KÄ±na tarafÄ±ndan yÃ¼rÃ¼tÃ¼len 
    <i>"Sinemada Kentin DÃ¶nÃ¼ÅŸÃ¼mÃ¼nÃ¼ Seyretmek: Ankara Ã–rneÄŸi"</i> baÅŸlÄ±klÄ± doktora tezi kapsamÄ±nda hazÄ±rlanmÄ±ÅŸtÄ±r.
  </div>
  <input id="search" placeholder="Haritada ara" aria-label="Haritada ara">
  <div id="film-list"></div>
</aside>
<div id="toggle-btn"><span>â—‚</span></div>
<div id="map"></div>

<script>
// folder temizleyici
function cleanFolderName(folder){
  if(!folder) return "";
  return folder.replace(/[\/|]+/g, '').trim();
}

// Harita
const map = L.map('map', {zoomControl:true}).setView([39.93,32.85],11);
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; OpenStreetMap contributors, &copy; Carto',
  maxZoom: 22, attributionControl: false
}).addTo(map);
map.zoomControl.setPosition('bottomright');
// SayÄ±sal Ã¶lÃ§ek bilgisi (sabit konumlu)
const scaleDiv = L.DomUtil.create('div', 'map-scale');
scaleDiv.style.position='absolute';
scaleDiv.style.bottom='10px';
scaleDiv.style.right='10px';
scaleDiv.style.padding='4px 8px';
scaleDiv.style.background='rgba(255,255,255,0.85)';
scaleDiv.style.borderRadius='4px';
scaleDiv.style.fontSize='10pt';
scaleDiv.style.color='#222';
scaleDiv.style.zIndex='1000';
map.getContainer().appendChild(scaleDiv);

function updateScale() {
  const zoom = map.getZoom();
  const scale = Math.round(40000000 / (256 * Math.pow(2, zoom)));
  const display = '1:' + scale.toLocaleString('tr-TR');
  scaleDiv.textContent = display;
}
map.on('zoomend', updateScale);
updateScale();


// Dinamik sayÄ±sal Ã¶lÃ§ek gÃ¶stergesi
const scaleDiv = L.DomUtil.create('div', 'map-scale');
scaleDiv.style.position='absolute';
scaleDiv.style.bottom='65px';
scaleDiv.style.right='10px';
scaleDiv.style.padding='4px 8px';
scaleDiv.style.background='rgba(255,255,255,0.8)';
scaleDiv.style.borderRadius='4px';
scaleDiv.style.fontSize='10pt';
scaleDiv.style.color='#222';
map.getContainer().appendChild(scaleDiv);

function updateScale() {
  const zoom = map.getZoom();
  const scale = Math.round(40000000 / (256 * Math.pow(2, zoom)));
  const display = '1:' + scale.toLocaleString('tr-TR');
  scaleDiv.textContent = display;
}
map.on('zoomend', updateScale);
updateScale();




let films = {};
let featureToLayer = new Map();
let allLayers = L.layerGroup().addTo(map);

// GeoJSON yÃ¼kle
fetch('kmzs.geojson')
.then(r=>r.json())
.then(data=>{
  data.features.forEach(f=>{
    const folder = cleanFolderName(f.properties?.folder);
    const film = folder || "Bilinmeyen Film";
    const name = f.properties?.name || "(AdsÄ±z MekÃ¢n)";
    if(!films[film]) films[film]=[];
    films[film].push(f);

    const geom = f.geometry;
    if(!geom) return;

    let layer = null;
    if(geom.type === 'Point'){
      const coords = [geom.coordinates[1], geom.coordinates[0]];
      const props = f.properties || {};
      const geom = f.geometry;
      const styleProps = props.style || {};
      const color = props.color || styleProps.color || '#2563eb';
      const fillColor = props.fillColor || styleProps.fillColor || color;
      const fillOpacity = props.fillOpacity ?? styleProps.fillOpacity ?? 1;
      const radius = props.radius || styleProps.radius || 6;
      const weight = props.weight || styleProps.weight || 1.5;
      const opacity = props.opacity ?? styleProps.opacity ?? 1;

      if (geom.type === 'Point') {
        const coords = [geom.coordinates[1], geom.coordinates[0]];
        if (props.iconUrl || styleProps.iconUrl) {
          const icon = L.icon({ iconUrl: props.iconUrl || styleProps.iconUrl, iconSize: props.iconSize || styleProps.iconSize || [24, 24] });
          layer = L.marker(coords, { icon });
        } else {
          layer = L.circleMarker(coords, { radius, color, fillColor, fillOpacity, weight, opacity });
        }
      } else {
        layer = L.geoJSON(f, {
          style: function() {
            return { color, fillColor, fillOpacity, weight, opacity };
          }
        });
      }
      }
    }

    if(layer){
      const props = f.properties || {};
      let desc = props.description || '';
      const imgMatches = desc.match(/<img[^>]*>/gi) || [];
      desc = desc.replace(/<img[^>]*>/gi, '').trim();
      if(props.image){ imgMatches.push(`<img src="${props.image}" alt="">`); }

      let popup = `<div style="font-family:-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif !important;">`;
      popup += `<div style="font-weight:700;font-size:11pt;margin-bottom:4px;">${name}</div>`;
      popup += `<div style="font-weight:500;font-size:10pt;margin-bottom:6px;">${folder}</div>`;
      if(desc){ popup += `<div style="font-weight:400;font-size:9pt;margin-bottom:8px;">${desc}</div>`; }
      if(imgMatches.length){ popup += imgMatches.join(''); }
      popup += `</div>`;

      layer.bindPopup(popup);
      layer.feature = f;
      allLayers.addLayer(layer);
      featureToLayer.set(f, layer);
    }
  });

  try{
    const b=allLayers.getBounds();
    if(b && b.isValid && b.isValid()) map.fitBounds(b.pad(0.08));
  }catch(e){ map.setView([39.93,32.85],11); }

  const filmList = document.getElementById('film-list');
  Object.keys(films)
  .sort((a,b)=>{
    const ya=parseInt((a.match(/\d{4}/)||[0])[0]);
    const yb=parseInt((b.match(/\d{4}/)||[0])[0]);
    return (ya||9999)-(yb||9999);
  })
  .forEach(film=>{
    const div=document.createElement('div');
    div.className='film';
    const title=document.createElement('div');
    title.className='film-title';
    title.textContent=film;
    const ul=document.createElement('ul');
    ul.className='mekan-list';

    films[film].forEach(feat=>{
      const li=document.createElement('li');
      li.textContent=feat.properties.name||'(AdsÄ±z Mekan)';
      li.onclick=(e)=>{
        e.stopPropagation();
        const layer=featureToLayer.get(feat);
        if(!layer) return;
        const g=feat.geometry;
        if(g.type==='Point'){ map.setView([g.coordinates[1],g.coordinates[0]],16); }
        layer.openPopup();
      };
      ul.appendChild(li);
    });

    title.onclick=()=>{
      ul.style.display=(ul.style.display==='none'||ul.style.display==='')?'block':'none';
    };
    div.appendChild(title);
    div.appendChild(ul);
    filmList.appendChild(div);
  });

  document.getElementById('search').addEventListener('input',(e)=>{
    const q=e.target.value.trim().toLowerCase();
    document.querySelectorAll('.film').forEach(div=>{
      const title=div.querySelector('.film-title').textContent.toLowerCase();
      const lis=Array.from(div.querySelectorAll('li')).map(li=>li.textContent.toLowerCase());
      const match=title.includes(q)||lis.some(t=>t.includes(q));
      div.style.display=match?'block':'none';
      if(q){
        div.querySelectorAll('li').forEach(li=>{
          const text=li.textContent;
          const re=new RegExp(q,'gi');
          li.innerHTML=text.replace(re, m=>'<mark>'+m+'</mark>');
        });
      } else {
        div.querySelectorAll('li').forEach(li=> li.innerHTML=li.textContent);
      }
    });
  });

  const sidebar=document.getElementById('sidebar');
  const toggle=document.getElementById('toggle-btn');
  const arrow=toggle.querySelector('span');
  toggle.addEventListener('click',()=>{
    sidebar.classList.toggle('closed');
    if(sidebar.classList.contains('closed')){
      toggle.style.left='0';
      arrow.textContent='â–¸';
    } else {
      toggle.style.left='340px';
      arrow.textContent='â—‚';
    }
    map.invalidateSize();
  });
})
.catch(err=>{
  console.error('GeoJSON load error', err);
  alert('GeoJSON yÃ¼klenemedi. Konsolu kontrol et.');
});
</script>
</body>
</html>
